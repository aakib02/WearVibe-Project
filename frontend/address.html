<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Address Selection - WearVibe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans">
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="flex items-center justify-between px-8 py-4">
            <div class="flex items-center space-x-4">
                <h1 class="text-2xl font-bold">WearVibe</h1>
                <div class="relative group">
                    <span class="material-symbols-outlined absolute left-3 top-2.5">search</span>
                    <input type="search" placeholder="Search fashion..."
                        class="pl-10 pr-4 py-2 border rounded-lg w-64" />
                </div>
            </div>
            <div class="flex items-center space-x-6">
                <div class="relative">
                    <button id="avatarButton"
                        class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-200 cursor-pointer">
                        <i class="fas fa-user text-gray-600 text-lg"></i>
                    </button>

                    <!-- Dropdown menu -->
                    <div id="userDropdown" class="absolute right-0 mt-2 w-44 bg-white divide-y divide-gray-100 rounded-lg shadow-lg hidden">
                        <a href="myprofile.html" class="block px-4 py-3 text-sm text-gray-900 hover:bg-gray-100 transition-colors">
                            <div>Bonnie Green</div>
                            <div class="font-medium truncate">name@flowbite.com</div>
                        </a>
                        <ul class="py-2 text-sm text-gray-700">
                            <li>
                                <a href="#" class="block px-4 py-2 hover:bg-gray-100">Order</a>
                            </li>
                            <li>
                                <a href="wishlist.html" class="block px-4 py-2 hover:bg-gray-100">Wishlist</a>
                            </li>
                            <li>
                                <a href="addtocart.html" class="block px-4 py-2 hover:bg-gray-100">Shopping Cart</a>
                            </li>
                        </ul>
                        <div class="py-1">
                            <a href="/src/components/Admin/login.html"
                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Logout</a>
                        </div>
                    </div>
                </div>

                <div class="relative">
                    <span class="material-symbols-outlined cursor-pointer" id="favorite-icon">favorite</span>
                    <span
                        class="absolute -top-2 -right-2 text-xs bg-red-500 text-white rounded-full w-4 h-4 flex items-center justify-center"
                        id="favorite-count">0</span>
                </div>
                <div class="relative">
                    <span class="material-symbols-outlined cursor-pointer" id="cart-icon">shopping_cart</span>
                    <span
                        class="absolute -top-2 -right-2 text-xs bg-red-500 text-white rounded-full w-4 h-4 flex items-center justify-center"
                        id="cart-count">0</span>
                </div>
            </div>
        </nav>
        <div class="flex justify-center space-x-8 py-4 border-t">
            <a href="mens.html" class="hover:underline">Men</a>
            <a href="#" class="hover:underline">Women</a>
            <a href="#" class="hover:underline">Kids</a>
        </div>
    </header>
    <div class="w-full mx-auto bg-white p-6 rounded-lg shadow-lg mt-10">
        <!-- Progress Bar -->
        <div class="flex justify-between mb-6">
            <div class="w-1/2 text-center font-bold text-blue-600">Address</div>
            <div class="w-1/2 text-center text-gray-400">Payment</div>
        </div>

        <!-- Address Selection -->
        <h2 class="text-xl font-semibold mb-4">Select Delivery Address</h2>
        <div class="bg-gray-50 p-4 rounded-lg">
            <label class="flex items-start space-x-3 cursor-pointer">
                <input type="radio" name="address" class="mt-1 form-radio" id="addressSelected">
                <div>
                    <h3 class="text-lg font-medium">Default Address</h3>
                    <p class="text-gray-600">Vidhi Jain (JINDI)</p>
                    <p class="text-gray-600">40, Gayatri Nagar-B, Maharanifarm, Durgapura</p>
                    <p class="text-gray-600">Estimated delivery by 17 Feb 2025</p>
                </div>
            </label>
        </div>
        <button class="mt-4 text-blue-600">+ Add New Address</button>

        <!-- Price Details -->
        <h2 class="text-xl font-semibold mt-6 mb-4">Price Details (1 Item)</h2>
        <div class="bg-gray-50 p-4 rounded-lg">
            <div class="flex justify-between mb-2">
                <p>Total MRP</p>
                <p id="totalMRP">₹0.00</p>
            </div>
            <div class="flex justify-between mb-2">
                <p>Discount</p>
                <p id="totalDiscount">₹0.00</p>
            </div>
            <div class="flex justify-between mb-2">
                <p>Shipping Fee</p>
                <p class="text-green-500">FREE</p>
            </div>
            <div class="flex justify-between font-bold text-lg">
                <p>Total Amount</p>
                <p id="totalAmount">₹0.00</p>
            </div>
        </div>


            <!-- Payment Method Selection -->
            <h2 class="text-xl font-semibold mt-6 mb-4">Select Payment Method</h2>
            <div class="bg-gray-50 p-4 rounded-lg">
                <label class="flex items-center space-x-3 cursor-pointer">
                    <input type="radio" name="payment" class="form-radio" id="codOption">
                    <span>Cash on Delivery (COD)</span>
                </label>
                <label class="flex items-center space-x-3 cursor-pointer mt-2">
                    <input type="radio" name="payment" class="form-radio" id="prepaidOption">
                    <span>Prepaid (Credit/Debit Card, UPI, Net Banking)</span>
                </label>
            </div>
 
    

        <div class="flex justify-center mt-6">
            <button id="proceedBtn" 
                class="bg-blue-600 text-white py-3 px-6 rounded-lg text-lg font-semibold">
                Proceed To Payment
            </button>
        </div>
        
    </div>

    <footer class="bg-gray-900 text-white mt-12">
        <div class="max-w-7xl mx-auto px-6 py-12">
            <div class="grid grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4">About Us</h3>
                    <p class="text-gray-400">WearVibe is your destination for trendy and comfortable clothing.</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="/src/components/Admin/requestforproduct.html"
                                class="text-gray-400 hover:text-white transition-colors">Sell Your Product</a></li>
                        <li><a href="/shop" class="text-gray-400 hover:text-white transition-colors">Shop</a></li>
                        <li><a href="contactquery.html"
                                class="text-gray-400 hover:text-white transition-colors">Help</a></li>
                        <li><a href="/faq" class="text-gray-400 hover:text-white transition-colors">FAQ</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Contact Us</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li>123 Fashion Street</li>
                        <li>Style City, SC 12345</li>
                        <li>contact@wearvibe.com</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Follow Us</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="hover:text-blue-400 transition-colors">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="hover:text-blue-400 transition-colors">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="hover:text-blue-400 transition-colors">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script>


const getCookie = (name) => {
    const cookies = document.cookie.split("; ");
    for (let cookie of cookies) {
        const [cookieName, cookieValue] = cookie.split("=");
        if (cookieName === name) return cookieValue;
    }
    return null;
};


async function fetchCartData() {
    try {
        const token = getCookie("token"); // Token se user ki authentication karein
        const res = await fetch("http://localhost:3000/api/getCart", {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${token}`
            }
        });

        const data = await res.json();
        console.log(data);

        if (data.success && Array.isArray(data.cart)) {
   // ✅ Total MRP Calculation (Original Price)
   const totalMRP = data.cart.reduce((sum, item) => sum + item.price * item.quantity, 0);

// ✅ Total Amount Calculation (Final Price after Discount)
const totalAmount = data.cart.reduce((sum, item) => sum + item.finalPrice * item.quantity, 0);

// ✅ Total Discount Calculation
const totalDiscount = totalMRP - totalAmount;

// ✅ HTML mein values update karna
document.getElementById("totalMRP").innerText = `₹${totalMRP.toFixed(2)}`;
document.getElementById("totalDiscount").innerText = `-₹${totalDiscount.toFixed(2)}`;
document.getElementById("totalAmount").innerText = `₹${totalAmount.toFixed(2)}`;
           
        }
    } catch (error) {
        console.log("Error fetching cart data:", error);
    }
}

document.addEventListener("DOMContentLoaded", function () {
    fetchCartData();

    document.getElementById("proceedBtn").addEventListener("click", function () {
        const codOption = document.getElementById("codOption");
        const prepaidOption = document.getElementById("prepaidOption");

        if (codOption.checked) {
            window.location.href = "order.html"; // COD ke liye order page
        } else if (prepaidOption.checked) {
            window.location.href = "payment.html"; // Prepaid ke liye prepaidOrder page
        } else {
            alert("Please select a payment method before proceeding!");
        }
    });
});

        document.getElementById('addressSelected').addEventListener('change', function() {
            let btn = document.getElementById('proceedBtn');
            btn.classList.remove('bg-gray-400', 'cursor-not-allowed');
            btn.classList.add('bg-blue-600');
            btn.disabled = false;
        });
 
        document.addEventListener("DOMContentLoaded", function () {

            const avatarButton = document.getElementById("avatarButton");
            const userDropdown = document.getElementById("userDropdown");

            avatarButton.addEventListener("click", function () {
                userDropdown.classList.toggle("hidden");
            });

            document.addEventListener("click", function (event) {
                if (!avatarButton.contains(event.target) && !userDropdown.contains(event.target)) {
                    userDropdown.classList.add("hidden");
                }
            });
        });
        
    </script>
</body>
</html>